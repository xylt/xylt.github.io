<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>jsoncpp使用说明 - 致知阁</title>
	<meta name="description" content="JSON全称为JavaScript ObjectNotation，它是一种轻量级的数据交换格式，易于阅读、编写、解析。jsoncpp是c++解析JSON串常用的解析库之一。">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta property="og:image" content="">
	<link rel="shortcut icon" href="/assets/img/favicon/favicon.ico" type="image/x-icon">
	<link rel="apple-touch-icon" href="/assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicon/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicon/apple-touch-icon-114x114.png">
	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#2d2a2a">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#2d2a2a">
	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-status-bar-style" content="#2d2a2a">

	<link href="https://fonts.googleapis.com/css?family=Finger+Paint|PT+Sans:400,700" rel="stylesheet">
	<link rel="stylesheet" href="/assets/fonts/font-awesome/css/font-awesome.min.css">
	<link rel="stylesheet" href="/assets/css/main.css">
</head>

<body>

  <aside class="sidebar">

  <div class="sidebar-container">
    <div class="sidebar-logo">
      <a href="/" class="logo">Stone05</a>
    </div>

    <menu class="sidebar-menu">
      <li class="menu-items"><a class="menu-links" href="/">主页</a></li>
      <li class="menu-items"><a class="menu-links" href="/about/">关于</a></li>
      <li class="menu-items"><a class="menu-links" href="/contact/">联系我</a></li>
      <li class="menu-items"><a class="menu-links" href="https://github.com/xylt">My Github</a></li>
    </menu>

    <div class="sidebar-social">
      <li class="social-items"><a href="https://github.com/xylt" class="social-links"><i class="social-icons fa fa-github" aria-hidden="true"></i></a></li>
    </div>

  </div>
</aside>


  <main role="main">
    <div class="content">
      <article class="page-article">
  <div class="wrap-content">
    <header class="page-header">
      <h1 class="page-title">jsoncpp使用说明</h1>
      <div class="page-date"><span>2018, Feb 15&nbsp;&nbsp;&nbsp;&nbsp;</span></div>
    </header>
    <div class="page-content">
      
      <img class="page-img" src=/assets/img/wooden_house.jpg alt="jsoncpp使用说明">
      
      <p>JSON全称为JavaScript ObjectNotation，它是一种轻量级的数据交换格式，易于阅读、编写、解析。jsoncpp是c++解析JSON串常用的解析库之一。</p>

<p>jsoncpp的配置下载<a href="https://github.com/open-source-parsers/jsoncpp">jsoncpp的github</a></p>
<h3 id="添加到工程">添加到工程</h3>

<h4 id="方法一使用jsoncpp包中的cpp和h文件">方法一：使用Jsoncpp包中的.cpp和.h文件</h4>

<p>解压上面下载的jsoncpp-master.zip文件，把jsoncpp-master\include\json文件夹和jsoncpp-master\src\lib_json文件夹里的全部文件拷贝到工程目录下，并且添加到到VS工程中。
在需要使用JsonCpp的文件中包含json头文件即可，如：#include “json/json.h”。另外，需要将json_reader.cpp、json_value.cpp和json_writer.cpp三个文件的Precompiled Header属性设置为Not Using Precompiled Headers，否则编译会出现错误。</p>
<h4 id="方法二使用jsoncpp生成的lib文件">方法二：使用Jsoncpp生成的lib文件</h4>

<p>解压上面下载的jsoncpp-master.zip文件，在jsoncpp-master\makefiles\vs71目录里找到jsoncpp.sln，用VS编译，默认生成静态链接库。 在工程中引用，只需要包含include/json下的头文件及生成的.lib文件即可。
在需要使用JsonCpp的文件中添加#pragma comment(lib.”json_vc71_libmt.lib”)，在工程属性中Linker下Input中Additional Dependencies写入lib文件名字（Release下为json_vc71_libmt.lib，Debug为json_vc71_libmtd.lib）注意：Jsoncpp的lib工程编译选项要和VS工程中的编译选项保持一致。如lib文件工程编译选项为MT（或MTd），VS工程中也要选择MT（或MTd），否则会出现编译错误问题。</p>

<h3 id="json文件">json文件</h3>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="p">[</span>
   <span class="p">{</span>
      <span class="s">"ColWidth"</span> <span class="o">:</span> <span class="p">[</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">85</span> <span class="p">],</span>
      <span class="s">"DlgName"</span> <span class="o">:</span> <span class="s">"窗口1"</span><span class="p">,</span>
      <span class="s">"FirstRowHeight"</span> <span class="o">:</span> <span class="mi">55</span><span class="p">,</span>
      <span class="s">"RowHeight"</span> <span class="o">:</span> <span class="mi">19</span>
   <span class="p">},</span>
   <span class="p">{</span>
      <span class="s">"ColWidth"</span> <span class="o">:</span> <span class="p">[</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">53</span> <span class="p">],</span>
      <span class="s">"DlgName"</span> <span class="o">:</span> <span class="s">"窗口2"</span><span class="p">,</span>
      <span class="s">"FirstRowHeight"</span> <span class="o">:</span> <span class="mi">50</span><span class="p">,</span>
      <span class="s">"RowHeight"</span> <span class="o">:</span> <span class="mi">30</span>
   <span class="p">}</span>
<span class="p">]</span>

</code></pre>
</div>

<h3 id="打开json文件">打开json文件</h3>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="kt">void</span> <span class="n">JsonOpre</span><span class="o">::</span><span class="n">OpenJsonFile</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">CString</span> <span class="n">m_StrFilePath</span><span class="p">;</span>
	<span class="c1">// 设置过滤器   
</span>	<span class="n">TCHAR</span> <span class="n">szFilter</span><span class="p">[]</span> <span class="o">=</span> <span class="n">_T</span><span class="p">(</span><span class="s">"json文件(*.json)|*.json|所有文件(*.*)|*.*||"</span><span class="p">);</span>   
	<span class="c1">// 构造保存文件对话框   
</span>	<span class="n">CFileDialog</span> <span class="n">fileDlg</span><span class="p">(</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">_T</span><span class="p">(</span><span class="s">"读取JSON"</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">szFilter</span><span class="p">);</span>  
	<span class="c1">// 显示保存文件对话框
</span>	<span class="k">if</span> <span class="p">(</span><span class="n">IDOK</span> <span class="o">==</span> <span class="n">fileDlg</span><span class="p">.</span><span class="n">DoModal</span><span class="p">())</span>
	<span class="p">{</span>
		<span class="c1">// 如果点击了菜单栏上的"另存为"按钮，则选择的保存的文件路径
</span>		<span class="n">m_StrFilePath</span> <span class="o">=</span> <span class="n">fileDlg</span><span class="p">.</span><span class="n">GetPathName</span><span class="p">();</span>
		<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">str</span> <span class="o">=</span> <span class="n">Auxiliary</span><span class="o">::</span><span class="n">CStringToString</span><span class="p">(</span><span class="n">m_StrFilePath</span><span class="p">);</span>
		<span class="k">if</span><span class="p">(</span><span class="n">ParseJsonFromFile</span><span class="p">(</span><span class="n">str</span><span class="p">.</span><span class="n">c_str</span><span class="p">()))</span> 
			<span class="n">acedAlert</span><span class="p">(</span><span class="n">_T</span><span class="p">(</span><span class="s">"数据成功！"</span><span class="p">));</span>
		<span class="k">else</span>
			<span class="n">acedAlert</span><span class="p">(</span><span class="n">_T</span><span class="p">(</span><span class="s">"数据保存失败！"</span><span class="p">));</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="读取json文件">读取json文件</h3>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="kt">bool</span> <span class="n">JsonOpre</span><span class="o">::</span><span class="n">ParseJsonFromFile</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">filename</span><span class="p">)</span>
<span class="p">{</span>
	<span class="c1">// 解析json用Json::Reader  
</span>	<span class="n">Json</span><span class="o">::</span><span class="n">Reader</span> <span class="n">reader</span><span class="p">;</span>  
	<span class="c1">// Json::Value是一种很重要的类型，可以代表任意类型。如int, string, object, array...  
</span>	<span class="n">Json</span><span class="o">::</span><span class="n">Value</span> <span class="n">root</span><span class="p">;</span>

	<span class="n">std</span><span class="o">::</span><span class="n">ifstream</span> <span class="n">is</span><span class="p">;</span>  
	<span class="n">CString</span> <span class="n">cfilename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">.</span><span class="n">c_str</span><span class="p">();</span>
	<span class="n">is</span><span class="p">.</span><span class="n">open</span> <span class="p">(</span><span class="n">cfilename</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">binary</span> <span class="p">);</span>    
	<span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">is</span><span class="p">,</span> <span class="n">root</span><span class="p">))</span>  
	<span class="p">{</span>  
		<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">code</span><span class="p">;</span>  
		<span class="k">if</span> <span class="p">(</span><span class="n">root</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1">// 访问节点，Access an object value by name, create a null member if it does not exist.  
</span>			<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
		<span class="c1">// 遍历数组  
</span>		<span class="n">DlgAttrVec</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
		<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">root</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>  
		<span class="p">{</span>  
			<span class="n">string</span> <span class="n">Dlgname</span> <span class="o">=</span> <span class="n">root</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">"DlgName"</span><span class="p">].</span><span class="n">asString</span><span class="p">();</span>
			<span class="kt">int</span> <span class="n">FirstRowHeight</span> <span class="o">=</span> <span class="n">root</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">"FirstRowHeight"</span><span class="p">].</span><span class="n">asInt</span><span class="p">();</span>
			<span class="kt">int</span> <span class="n">RowHeight</span> <span class="o">=</span> <span class="n">root</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">"RowHeight"</span><span class="p">].</span><span class="n">asInt</span><span class="p">();</span>
			<span class="kt">int</span> <span class="n">ColWidth_size</span> <span class="o">=</span> <span class="n">root</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">"ColWidth"</span><span class="p">].</span><span class="n">size</span><span class="p">();</span>
			<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">ColWidthVec</span><span class="p">;</span>
			<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">ColWidth_size</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">ColWidthVec</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">root</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">"ColWidth"</span><span class="p">][</span><span class="n">j</span><span class="p">].</span><span class="n">asInt</span><span class="p">());</span>
			<span class="p">}</span>
			<span class="n">DlgAttrVec</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">new</span> <span class="n">DlgAttr</span><span class="p">(</span><span class="n">Dlgname</span><span class="p">,</span> <span class="n">FirstRowHeight</span><span class="p">,</span> <span class="n">RowHeight</span><span class="p">,</span> <span class="n">ColWidthVec</span><span class="p">)));</span>
		<span class="p">}</span>  
	<span class="p">}</span>  
	<span class="n">is</span><span class="p">.</span><span class="n">close</span><span class="p">();</span> 

	<span class="k">return</span> <span class="nb">true</span><span class="p">;</span> 
<span class="p">}</span>
</code></pre>
</div>

<h3 id="存储json文件">存储json文件</h3>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="kt">bool</span> <span class="n">JsonOpre</span><span class="o">::</span><span class="n">DataSaveJsonInFile</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">filename</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">Json</span><span class="o">::</span><span class="n">Value</span> <span class="n">root</span><span class="p">;</span>
	<span class="n">Json</span><span class="o">::</span><span class="n">Value</span> <span class="n">NewDlg</span><span class="p">;</span> 
	<span class="n">Json</span><span class="o">::</span><span class="n">Value</span> <span class="n">arrayColWidth</span><span class="p">;</span>   <span class="c1">// 构建对象 
</span>
	<span class="n">root</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">DlgAttrVec</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
		<span class="n">NewDlg</span><span class="p">[</span><span class="s">"DlgName"</span><span class="p">]</span> <span class="o">=</span> <span class="n">DlgAttrVec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Dlgname</span><span class="p">;</span>
		<span class="n">NewDlg</span><span class="p">[</span><span class="s">"FirstRowHeight"</span><span class="p">]</span> <span class="o">=</span> <span class="n">DlgAttrVec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">FirstRowHeight</span><span class="p">;</span>
		<span class="n">NewDlg</span><span class="p">[</span><span class="s">"RowHeight"</span><span class="p">]</span> <span class="o">=</span> <span class="n">DlgAttrVec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">RowHeight</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">ColWidth_size</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">DlgAttrVec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ColWidthVec</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
		<span class="n">arrayColWidth</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
		<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">ColWidth_size</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">arrayColWidth</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">DlgAttrVec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ColWidthVec</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
		<span class="p">}</span>
		<span class="n">NewDlg</span><span class="p">[</span><span class="s">"ColWidth"</span><span class="p">]</span> <span class="o">=</span> <span class="n">arrayColWidth</span><span class="p">;</span>
		<span class="n">root</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">NewDlg</span><span class="p">);</span>  <span class="c1">// 插入数组成员 
</span>	<span class="p">}</span>
	<span class="c1">//输出（另起一个方法）
</span>	<span class="c1">//转换为字符串（带格式）
</span>	<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">out</span> <span class="o">=</span> <span class="n">root</span><span class="p">.</span><span class="n">toStyledString</span><span class="p">();</span>

	<span class="n">std</span><span class="o">::</span><span class="n">ofstream</span> <span class="n">os</span><span class="p">;</span> 
	<span class="n">CString</span> <span class="n">cfilename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">.</span><span class="n">c_str</span><span class="p">();</span>
	<span class="n">os</span><span class="p">.</span><span class="n">open</span> <span class="p">(</span><span class="n">cfilename</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">binary</span> <span class="p">);</span>    
	<span class="n">os</span><span class="o">&lt;&lt;</span><span class="n">out</span><span class="p">;</span>
	<span class="n">os</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>   
	<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

</code></pre>
</div>

    </div>
    

  </div>
</article>

    </div>
  </main>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', '', 'auto');
  ga('send', 'pageview');
</script>

</body>
</html>
